<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Stellar Map</title>
    <style>
      body {
        margin: 0;
      }
      canvas {
        width: 100%;
        height: 100%;
      }
    </style>

    <link
      href="css/style.css"
      type="text/css"
      rel="stylesheet"
      media="screen,projection"
    />
  </head>
  <body>
    <header
      class="stellar-header"
      style="font-size: 2em; background-color: black; color: white;"
    >
      Stellar Map
    </header>
    <script src="js/three.min.js"></script>
    <script src="../node_modules/three/examples/js/controls/OrbitControls.js"></script>
    <script src="../node_modules/d3/dist/d3.min.js"></script>

    <script>
      // Our Javascript will go here.
      // To display anything with three.js, we need scene, camera and renderer
      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );

      camera.position.z = 10;

      var renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      var controls = new THREE.OrbitControls(camera, renderer.domElement);

      // Cube
      var geometry = new THREE.BoxGeometry(1, 1, 1);
      meshBox = new THREE.Mesh(geometry, 0);
      var geo = new THREE.EdgesGeometry(meshBox.geometry);
      var mat = new THREE.LineBasicMaterial({ color: 0xffffff, linewidth: 2 });
      var wireframe = new THREE.LineSegments(geo, mat);
      scene.add(wireframe);

      var light = new THREE.PointLight(0xffff00);
      /* position the light so it shines on the cube (x, y, z) */
      light.position.set(10, 0, 25);
      scene.add(light);

      camera.position.z = 1.5;
      var mouse = new THREE.Vector2(1, 1);

      document.addEventListener('mousemove', onMouseMove, false);
      window.addEventListener('resize', onWindowResize, false);

      // load file
      const hygData = [];

      d3.csv('data/hygdata_prepared.csv').then(function(data) {
        data.forEach(function(d) {
          d.xCoord = +d.xCoord;
          d.yCoord = +d.yCoord;
          d.zCoord = +d.zCoord;
          d.absoluteMagnitude = +d.absoluteMagnitude;
          hygData.push(d);
        });
        // console.log(data[0]);
        // console.log(hygData[0].xCoord);
        // console.log(hygData[0].absoluteMagnitude);

        // Location of stars from file
        var starGeometry = new THREE.Geometry();

        for (var i = 0; i < hygData.length; i++) {
          var x = hygData[i].xCoord;
          var y = hygData[i].yCoord;
          var z = hygData[i].zCoord;
          var absMagnitude = hygData[i].absoluteMagnitude;

          var coordinates = new THREE.Vector3(x, y, z);
          var SphereGeometry = new THREE.SphereGeometry(0.02, 8, 6);
          var material = new THREE.MeshBasicMaterial({ color: 0xffff00 });
          var mesh = new THREE.Mesh(SphereGeometry, material);

          mesh.position.x = x;
          mesh.position.y = y;
          mesh.position.z = z;

          scene.add(mesh);

          // var star = new THREE.Sphere(coordinates, 0.1);
          // scene.add(star);

          // starGeometry.vertices.push(new THREE.Vector3(x, y, z));
          // var dotMaterial = new THREE.PointsMaterial({
          //   size: absMagnitude,
          //   sizeAttenuation: false
          // });
        }

        //var star = new THREE.Points(starGeometry, dotMaterial);
      });

      // functions
      function onMouseMove(event) {
        event.preventDefault();
        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      // Render the scene
      function animate() {
        requestAnimationFrame(animate);

        controls.update();
        renderer.render(scene, camera);
      }
      animate();
    </script>
  </body>
</html>
